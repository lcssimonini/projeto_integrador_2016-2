package br.com.sixfit.servlets;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.sendgrid.SendGrid;

@WebServlet("/disparaEmail")
public class DisparaEmailServlet extends HttpServlet {

	private static final long serialVersionUID = 4088447823106399481L;
	
	private static final String API_KEY = "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";
	private SendGrid sendgrid;

	protected void doPost(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {

		sendgrid = new SendGrid(API_KEY);
		
		String nome = request.getParameter("name");
		String email = request.getParameter("email");
		String assunto = request.getParameter("subject");
		String mensagem = request.getParameter("feedback");
		
		System.out.println(nome);
		System.out.println(email);
		System.out.println(assunto);
		System.out.println(mensagem);
		
		String boraLa = "<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'> <html xmlns='http://www.w3.org/1999/xhtml'> <head> <title></title> <meta http-equiv='Content-Type' content='text/html; charset=utf-8' /> <meta name='viewport' content='width=device-width, initial-scale=1' /> <meta http-equiv='X-UA-Compatible' content='IE=edge' /> <style type='text/css'> /* FONTS */ @media screen {@font-face {font-family: 'Lato'; font-style: normal; font-weight: 400; src: local('Lato Regular'), local('Lato-Regular'), url(https://fonts.gstatic.com/s/lato/v11/qIIYRU-oROkIk8vfvxw6QvesZW2xOQ-xsNqO47m55DA.woff) format('woff'); } @font-face {font-family: 'Lato'; font-style: normal; font-weight: 700; src: local('Lato Bold'), local('Lato-Bold'), url(https://fonts.gstatic.com/s/lato/v11/qdgUG4U09HnJwhYI-uK18wLUuEpTyoUstqEm5AMlJo4.woff) format('woff'); } @font-face {font-family: 'Lato'; font-style: italic; font-weight: 400; src: local('Lato Italic'), local('Lato-Italic'), url(https://fonts.gstatic.com/s/lato/v11/RYyZNoeFgb0l7W3Vu1aSWOvvDin1pK8aKteLpeZ5c0A.woff) format('woff'); } @font-face {font-family: 'Lato'; font-style: italic; font-weight: 700; src: local('Lato Bold Italic'), local('Lato-BoldItalic'), url(https://fonts.gstatic.com/s/lato/v11/HkF_qI1x_noxlxhrhMQYELO3LdcAZYWl9Si6vvxL-qU.woff) format('woff'); } } /* CLIENT-SPECIFIC STYLES */ body, table, td, a { -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; } table, td { mso-table-lspace: 0pt; mso-table-rspace: 0pt; } img { -ms-interpolation-mode: bicubic; } /* RESET STYLES */ img { border: 0; height: auto; line-height: 100%; outline: none; text-decoration: none; } table { border-collapse: collapse !important; } body { height: 100% !important; margin: 0 !important; padding: 0 !important; width: 100% !important; } /* iOS BLUE LINKS */ a[x-apple-data-detectors] {color: inherit !important; text-decoration: none !important; font-size: inherit !important; font-family: inherit !important; font-weight: inherit !important; line-height: inherit !important; } /* MOBILE STYLES */ @media screen and (max-width:600px){h1 {font-size: 32px !important; line-height: 32px !important; } } img.pattern{margin-left:auto; margin-right:auto; } @media only screen and (max-width: 599px) {img.pattern {max-width: 100%; height: auto !important; } } /* ANDROID CENTER FIX */ div[style*='margin: 16px 0;'] { margin: 0 !important; } .im{color: #666 !important;}</style> </head> <body style=\"background-color: #f7f7f7; Margin: 0 !important; padding: 0 !important;\"> <!-- HIDDEN PREHEADER TEXT --> <div style=\"display: none; font-size: 1px; color: #fefefe; line-height: 1px; font-family: 'Lato', Helvetica, Arial, sans-serif; max-height: 0px; max-width: 0px; opacity: 0; overflow: hidden;\"> SixFit</div> <table border='0' cellpadding='0' cellspacing='0' width='100%'> <!-- LOGO --> <tr> <td bgcolor='#f7f7f7' align='center' style=\"padding: 0px 5px 0px 5px;\"> <table border='0' cellpadding='0' cellspacing='0' width='100%' style=\"max-width: 600px; border-top: 1px solid #d9d9d9; border-left: 1px solid #d9d9d9; border-right: 1px solid #d9d9d9; Margin-top: 40px;\"> <tr> <td bgcolor='#ffffff' align='center' valign='middle' style=\"padding: 40px 0px 40px 0px;\">  <img src= \"data:image/png;base64,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\" width='155' style=\"display: block; width: 155px; max-width: 155px; min-width: 155px; font-family: 'Lato', Helvetica, Arial, sans-serif; color: #ffffff; font-size: 18px; position:relative; left:-12px; vertical-align: middle; border: 0; min-height: auto; line-height: 100%; outline: none; text-decoration: none;\" border='0'/>  </td> <td bgcolor='#ffffff' align='center' valign='middle' style=\"padding: 40px 0px 40px 0px;\"> </td> </tr> </table> </td> </tr> <!-- HERO --> <tr> <td bgcolor='#f7f7f7' align='center' style=\"padding: 0px 5px 0px 5px;\"> <table border='0' cellpadding='0' cellspacing='0' width='100%' style=\"max-width: 600px; border-left: 1px solid #d9d9d9; border-right: 1px solid #d9d9d9;\"> <tr> <td bgcolor='#E27D15' align='center' valign='top' style=\"padding: 15px 0px 20px 0px; color: #ffffff; font-family: 'Lato', Helvetica, Arial, sans-serif; font-size: 24px; font-weight: 400;\"> <h3 style=\"font-size: 24px; font-weight: 400; Margin: 0;\">Contato Resgistrado</h3> </td> </tr> </table> </td> </tr> <!-- COPY BLOCK --> <tr> <td bgcolor='#f7f7f7' align='center' style=\"padding: 0px 5px 0px 5px;\"> <table border='0' cellpadding='0' cellspacing='0' width='100%' style=\"max-width: 600px; border-left: 1px solid #d9d9d9; border-right: 1px solid #d9d9d9;\"> <tr> <td bgcolor='#ffffff' align='justify' style=\"padding: 20px 30px 0px 30px; color: #666666; font-family: 'Lato', Helvetica, Arial, sans-serif; font-size: 18px; font-weight: 400; line-height: 25px;\"> <br> <p style=\"Margin: 0px; font-size: 14px\">Boa noite <strong style=\"color:#E27D15; font-weight:bold; font-size:18px\"> " + nome + "</strong>!</p> <br> <p style=\"Margin: 0px; font-size: 14px\">O contato foi registrado com a seguinte mensagem: </p> <p style=\"Margin: 0px; font-size: 14px\"> <strong style=\"color:#E27D15; font-weight:bold; font-size:18px\"> " + mensagem + " </strong></p> </td> </tr> <tr> </table> </td> </tr> <tr> <td bgcolor='#f7f7f7' align='center' style=\"padding: 0px 5px 0px 5px;\"> <table border='0' cellpadding='0' cellspacing='0' width='100%' style=\"max-width: 600px; border-left: 1px solid #d9d9d9; border-right: 1px solid #d9d9d9;\"> </table> </td> </tr> <tr> <td bgcolor='#f7f7f7' align='center' style=\"padding: 0px 5px 0px 5px;\"> <table border='0' cellpadding='0' cellspacing='0' width='100%' style=\"max-width: 600px; border-left: 1px solid #d9d9d9; border-right: 1px solid #d9d9d9;\"> <tr> <tr> <td bgcolor='white' align='center' style=\"padding: 0px 5px 0px 5px;\"><br><br></td> </tr> </tr> </table> </td> </tr> <tr> <td bgcolor='#f7f7f7' align='center' style=\"padding: 0px 5px 0px 5px;\"> <table border='0' cellpadding='0' cellspacing='0' width='100%' style=\"max-width: 600px; border-left: 1px solid #d9d9d9; border-right: 1px solid #d9d9d9;\"> <tr> <td bgcolor='#ffffff' align='left'> <table width='100%' border='0' cellspacing='0' cellpadding='0'> <tr> <td bgcolor='#ffffff' align='center' style=\"padding: 40px 20px 40px 20px;\"> <table border='0' cellspacing='0' cellpadding='0'> <tr> <td align='left' valign='top' style=\"padding-right:10px; padding-bottom:10px; padding-left:10px\"><a href='mailto:contato@Sixfit.info' style=\"color: #666666; text-decoration: none\" title='Email Sixfit' target='_blank'><img src='http://cdn-images.mailchimp.com/template_images/gallery/email_icon.png' height='54' width='54' class='x_mcnImage' style=\"display:block; height:auto; max-width:100%\"></a> </td> <td align='right'><a href='mailto:rafael.calixto@sankhya.com.br' style=\"color: #666666; text-decoration: none\" title='Email Sixfit' target='_blank'><span>Alguma dúvida? <strong style=\"color:#E27D15; font-weight:bold; font-size:18px\">Clique aqui  </strong> para enviar um e-mail para nossa equipe!</span>  </a></td> </tr> </table> </td> </tr> </table> </td> </tr> </table> </td> </tr> <tr> <td bgcolor='#f7f7f7' align='center' style=\"padding: 0px 5px 0px 5px;\"> <table border='0' cellpadding='0' cellspacing='0' width='100%' style=\"max-width: 600px; border-left: 1px solid #d9d9d9;\"> <tr> <td bgcolor='#ffffff' align='center' style=\"padding: 0px 30px 16px 30px; color: #666666; font-family: 'Lato', Helvetica, Arial, sans-serif; font-size: 14px; font-weight: 400; line-height: 25px;\"> <h3>Atenciosamente,</h3> <p style=\"Margin: 0; text-align: center;\">Equipe Sixfit.</p> <span style=\"color:#E27D15; font-size:11px\">Esta é uma mensagem automática, favor não respondê-la.</span> </td> </tr> </table> </td> </tr> <!-- SUPPORT CALLOUT --> <tr> <td bgcolor='#f7f7f7' align='center' style=\"padding: 0px 5px 0px 5px;\"> <table border='0' cellpadding='0' cellspacing='0' width='100%' style=\"max-width: 600px; border-left: 1px solid #d9d9d9; border-right: 1px solid #d9d9d9; border-bottom: 1px solid #d9d9d9; Margin-bottom: 40px;\"> <!-- HEADLINE --> <tr> <td bgcolor='#ffffff' align='center' style=\"padding: 0px 30px 30px 30px; border-radius: 4px 4px 4px 4px; color: #666666; font-family: 'Lato', Helvetica, Arial, sans-serif; font-size: 18px; font-weight: 400; line-height: 25px;\"> <table border='0' cellpadding='0' cellspacing='0' width='100%' style=\"border-collapse: collapse; background-color: #ffffff\"> <tbody> <tr> <td width='80%' style=\"padding-bottom: 16px; text-align: center\"> <hr style=\"width: 80%; border: 0; border-top: 1px solid #ddd\"/> </td> </tr> <tr> <td style=\"padding-bottom: 16px; text-align: center\"> <hr style=\"Margin-right: auto; Margin-left: auto; width: 30px; border: 0; border-top: 1px solid #ddd\"/> <p style=\"font-family:'Lato',Helvetica,Arial,sans-serif; text-align:center; color:#999; font-size:12px\">Sixfit 2016</p> </td> </tr> </tbody> </table> </td> </tr> </table> </td> </tr> </table> </body> </html>";
		
		// NAO TIRA O RAFAEL.CALIXTO@SANKHYA.COM.BR o cadastro foi feito no meu email
		sendEmail("rafael.calixto@sankhya.com.br",email, assunto, boraLa);
	}

	protected void doGet(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		doPost(request, response);
	}

	private void sendEmail(String fromEmail, String toEmail, String assunto, String message) {
		try{
			SendGrid.Email email = new SendGrid.Email();
			email.setFrom(fromEmail);
			email.addTo(toEmail);
			email.addToName("Nome To");
			
			email.setSubject(assunto);
			email.setHtml(message);
			sendgrid.send(email);
		} catch(Exception e) {
			e.printStackTrace();
		}
	}
}
